# 技术报告：

# 基于五次多项式与4WS-MPC的车辆轨迹规划与跟踪

日期: 2025年10月30日

版本: 1.0

编制: [您的姓名/团队]

## 1. 摘要 (Abstract)

本报告提出了一种先进的车辆运动控制架构，旨在解决从任意起始状态（位置 $A$，航向 $\phi_1$）到目标状态（位置 $B$，航向 $\phi_2$）的精确轨迹规划与跟踪问题。该架构利用五次多项式生成运动学平滑的参考轨迹，并采用基于二自由度（2-DOF）四轮转向（4WS）车辆模型的模型预测控制（MPC）作为跟踪控制器。此方案充分发挥了五次多项式的平滑性、MPC的优化和约束处理能力，以及4WS系统卓越的机动性和稳定性。

## 2. 引言 (Introduction)

在自动驾驶和高级辅助驾驶系统（ADAS）中，精确、平滑且动力学可行的轨迹跟踪是核心挑战。传统的点跟踪控制（如PID, LQR）难以在复杂约束和高速机动下保证最优性能。特别是当车辆配备四轮转向（4WS）系统时，如何充分利用其额外的控制自由度（即后轮转向）来实现更高机动性（如低速时的零侧偏角转向）和更高稳定性（如高速时的协调转向），是本报告研究的重点。

本报告的架构分为两层：

1. **参考轨迹规划层** ：使用五次多项式，根据给定的边界条件（A点和B点的$x, y, \phi$）生成一条时间最优或平滑度最优的理想轨迹。
2. **轨迹跟踪控制层** ：使用模型预测控制（MPC），该控制器内嵌一个二自由度4WS车辆动力学模型，以最小化跟踪误差并满足所有物理约束。

## 3. 系统架构 (System Architecture)

本系统的协同工作流程如下图所示：

[一个流程图的示意描述]

1. **输入** ：起始状态 $P_A(x_A, y_A, \phi_1)$ 和目标状态 $P_B(x_B, y_B, \phi_2)$，以及期望总时间 $T$。
2. **轨迹规划器 (五次多项式)** ：

* 离线或在线计算出一条完整的参考轨迹 $\mathbf{x}_{ref}(t) = [x_{ref}(t), y_{ref}(t), \phi_{ref}(t)]$。

1. **MPC 控制器** ：

* 在每个时间步 $k$：
* **输入1** ：来自规划器的 **未来 ** $N_p$** 步**的参考轨迹 $\mathbf{x}_{ref}(k \to k+N_p)$。
* **输入2** ：来自车辆传感器（State Estimation）的**当前车辆状态** $\mathbf{x}_{curr}(k)$。
* **预测 (M)** ：使用 2-DOF 4WS 模型预测未来 $N_p$ 步的车辆状态。
* **优化 (P)** ：求解一个优化问题，找到未来 $N_c$ 步的最佳控制序列 $\mathbf{u}^*(k) = [\delta_f(t), \delta_r(t)]$。
* **约束 (C)** ：优化必须满足轮胎、转向角、转向速率等物理限制。

1. **车辆执行器** ：

* 应用优化序列中的**第一个**控制命令 $\mathbf{u}^*(0) = [\delta_f(0), \delta_r(0)]$。

1. **（反馈）** 车辆运动到新的状态 $\mathbf{x}_{curr}(k+1)$，循环开始。

## 4. 核心技术详解

### 4.1. 参考轨迹规划：五次多项式 (5th-Order Polynomial)

五次多项式因其能同时定义起点和终点的位置、速度、加速度（共6个边界条件）而被广泛采用。

为满足您的需求，我们将2D问题解耦为两个独立的1D时间问题：$x(t)$ 和 $y(t)$。

$$
x(t) = a_5 t^5 + a_4 t^4 + a_3 t^3 + a_2 t^2 + a_1 t + a_0
$$


$$
y(t) = b_5 t^5 + b_4 t^4 + b_3 t^3 + b_2 t^2 + b_1 t + b_0
$$

我们必须设定起始/终点速度 

$v_A, v_B$

 和加速度 

$a_A, a_B$

$x(t)$** 的6个边界条件：**

1. $x(0) = x_A$ (位置)
2. $x'(0) = v_A \cdot \cos(\phi_1)$ (速度)
3. $x''(0) = a_A \cdot \cos(\phi_1) \approx 0$ (加速度)
4. $x(T) = x_B$
5. $x'(T) = v_B \cdot \cos(\phi_2)$
6. $x''(T) = a_B \cdot \cos(\phi_2) \approx 0$

$y(t)$** 的6个边界条件：**

1. $y(0) = y_A$![]()
2. $y'(0) = v_A \cdot \sin(\phi_1)$![]()
3. $y''(0) = a_A \cdot \sin(\phi_1) \approx 0$![]()
4. $y(T) = y_B$![]()
5. $y'(T) = v_B \cdot \sin(\phi_2)$![]()
6. $y''(T) = a_B \cdot \sin(\phi_2) \approx 0$![]()

通过求解两个 $6 \times 6$ 的线性方程组（或更简单的 $3 \times 3$ 矩阵，如您之前所见），我们可以得到所有系数 $a_i, b_i$。

 **输出** ：一条 $(x_{ref}(t), y_{ref}(t))$ 轨迹，它在运动学上极其平滑，并完美满足您的起止航向角约束。这条轨迹将作为MPC的“理想目标”。

### 4.2. 预测模型：二自由度四轮转向 (2-DOF 4WS Model)

这是MPC控制器的核心“M”。我们采用“自行车模型”，它关注车辆的 **横向动力学** （侧向运动 $y$）和 **横摆动力学** （偏航 $\psi$）。

 **与标准2-DOF模型的关键区别** ：

* **标准模型** ：控制输入 $\mathbf{u} = [\delta_f]$ (仅前轮转角)。
* **4WS模型** ：控制输入 $\mathbf{u} = [\delta_f, \delta_r]$ (前轮和后轮转角)。

**状态变量** $\mathbf{x} = [y, \dot{y}, \psi, \dot{\psi}]^T$：

* $y$: 车辆质心(CG)的横向位移
* $\dot{y}$: 横向速度
* $\psi$: 横摆角（航向角）
* $\dot{\psi}$: 横摆角速度（Yaw Rate）

假设纵向速度 $v_x$ 恒定（或变化缓慢），并采用线性轮胎模型，车辆动力学方程可表示为标准的状态空间形式：

$$
\dot{\mathbf{x}} = A\mathbf{x} + B\mathbf{u}
$$

其中 $A$ 矩阵描述了车辆的固有特性（质量 $m$, 转动惯量 $I_z$, 纵向速度 $v_x$, 轮胎侧偏刚度 $C_f, C_r$等），而 $B$ 矩阵则描述了控制输入如何影响车辆状态。

 **4WS 模型的 ** $B$ ** 矩阵** （示意）：

$$
B = \begin{pmatrix}
0 & 0 \\
\frac{C_f}{m} & \frac{C_r}{m} \\
0 & 0 \\
\frac{a \cdot C_f}{I_z} & \frac{-b \cdot C_r}{I_z}
\end{pmatrix}
$$

($a, b$ 分别为质心到前/后轴的距离)

 **注意** ：此模型是一个线性时变（LTV）模型，因为 $A$ 和 $B$ 矩阵中的项取决于当前的 $v_x$。在MPC的每个时间步，我们都需要根据当前的 $v_x$ 重新计算 $A, B$ 矩阵，并将其**离散化**为 $\mathbf{x}_{k+1} = A_d \mathbf{x}_k + B_d \mathbf{u}_k$ 以用于数字控制。

### 4.3. 轨迹跟踪控制器：MPC (Model Predictive Control)

MPC在每个时间步求解一个 **有限时域开环优化问题** 。

1. 预测 (Prediction):

使用 4.2 节的离散化模型 $\mathbf{x}_{k+1} = A_d \mathbf{x}_k + B_d \mathbf{u}_k$，从当前状态 $\mathbf{x}_{curr}$ 出发，预测未来 $N_p$（预测时域）步的车辆状态。这个预测依赖于一组待定的控制序列 $\mathbf{U} = [\mathbf{u}_k, ..., \mathbf{u}_{k+N_c-1}]$ ($N_c$ 为控制时域)。

2. 优化 (Optimization):

寻找最优的控制序列 $\mathbf{U}^*$，以最小化一个代价函数 $J$。代价函数通常包含：

$$
J = \sum_{i=1}^{N_p} \| \mathbf{x}_{pred}(k+i) - \mathbf{x}_{ref}(k+i) \|^2_Q + \sum_{i=1}^{N_c} \| \mathbf{u}(k+i) \|^2_R + \sum_{i=1}^{N_c} \| \Delta \mathbf{u}(k+i) \|^2_S
$$

* $\|\cdot\|_Q$ ** (跟踪误差)** ：惩罚车辆预测状态 $\mathbf{x}_{pred}$ 与五次多项式参考轨迹 $\mathbf{x}_{ref}$ 之间的差距。$Q$ 是权重矩阵，我们可以设置更高的权重给 $y$ (位置) 和 $\psi$ (航向)。

* $\|\cdot\|_R$ ** (控制代价)** ：惩罚过大的控制输入（即过大的 $\delta_f$ 和 $\delta_r$），保证平顺。
* $\|\cdot\|_S$ ** (控制变化率)** ：惩罚控制输入的剧烈变化（$\Delta \mathbf{u}$），保证舒适性。

3. 约束 (Constraints):

这是MPC（以及4WS模型）最关键的部分。优化必须在以下约束下进行：

* **动力学约束 (M)** ：$\mathbf{x}_{k+1} = A_d \mathbf{x}_k + B_d \mathbf{u}_k$ (物理模型必须遵守)
* **轮胎约束** ：为保证线性模型有效，轮胎侧偏角必须在小范围内（例如 $|\alpha_f| < 5^\circ, |\alpha_r| < 5^\circ$）。这可以被转化为对 $\dot{y}$ 和 $\dot{\psi}$ 的约束。
* **执行器约束 (C)** ：
* $|\delta_f| \le \delta_{f,max}$ (例如 $30^\circ$)
* $|\delta_r| \le \delta_{r,max}$ (例如 $15^\circ$)
* $|\dot{\delta}_f| \le \dot{\delta}_{max}$ (转向速率限制, e.g., $100^\circ/s$)
* $|\dot{\delta}_r| \le \dot{\delta}_{max}$

## 5. 4WS 带来的优势分析

为什么采用 4WS-MPC 而不是 2WS-MPC？

1. **更优的解空间** ：MPC的优化器现在有两个控制输入 ($\delta_f, \delta_r$) 来最小化代价函数 $J$。
2. **高速稳定性** ：当参考轨迹需要高速换道（$\dot{y}$ 较大）时，标准2WS车辆会有较大的横摆（$\dot{\psi}$），导致甩尾感。4WS-MPC为了最小化 $J$（特别是 $\psi$ 和 $\dot{\psi}$ 的误差），会**自动**计算出一个 $\delta_r$ 与 $\delta_f$ 同向（或一个特定比例），以实现**零侧偏角**或最小横摆的平移，极大提升了稳定性。
3. **低速机动性** ：当参考轨迹需要小半径转弯（如泊车）时，MPC会自动计算出 $\delta_r$ 与 $\delta_f$ 反向，以最小化转弯半径，实现2WS无法达到的机动性。
4. **鲁棒性** ：由于MPC的“滚动优化”特性，即使五次多项式规划的轨迹在某处略微超出了动力学极限，MPC也会尽力跟踪，找到一个“物理上最接近”的执行轨迹，而不是像开环控制器那样直接失控。

## 6. 结论 (Conclusion)

本报告提出了一套结合了 **五次多项式规划** 、**MPC** 和 **2-DOF 4WS模型**的完整运动控制方案。该方案利用五次多项式提供了平滑且满足起止姿态约束的理想蓝图，同时利用4WS-MPC作为一个强大的执行者，它不仅能精确跟踪该蓝图，还能在跟踪过程中充分利用4WS的物理优势，并严格遵守所有动力学和执行器约束，从而实现安全、高效、稳定和舒适的车辆运动控制。

$$


$$
